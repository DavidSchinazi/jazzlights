<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!-- link rel="apple-touch-icon" href="icon.png">
    <link rel="apple-touch-startup-image" href="startup.png" -->
    <meta name="author" content="Dmitry Azovtsev">
    <style>
      body {
        overflow: hidden;
        background: #000;
        color: #00dd00;
      }
      #status {
        position: absolute; 
        top: 40pt; 
        left: 0pt; 
        right: 0pt; 
        height: 80pt;
        box-sizing: border-box;
        padding: 15pt;
        font-size: 50pt;
        text-align: center;
      }
      #controls {
        position: absolute; 
        bottom: 20pt; 
        left: 0pt; 
        right: 0pt; 
        height: 180pt;
        box-sizing: border-box;
        text-align: center;
      }
      #sysinfo {
        position: absolute; 
        bottom: 0pt; 
        left: 0pt; 
        right: 0pt; 
        height: 20pt;
        box-sizing: border-box;
        padding-right: 5px;
        text-align: right;
      }
      .big-icon-button {
        background-color: #000;
        border: solid currentColor 7pt;
        padding: 30px;
        display: inline-block;
        width: 50pt;
        height: 50pt;
        border-radius: 50%;
        margin: 20pt;
      }
      .big-icon-button svg {
        display: inline-block;
        width: 100%;
        height: 100%;
        stroke-width: 0;
        stroke: currentColor;
        fill: currentColor;
      }
      .big-icon-button:hover {
        color: #00ff00;
      }
      .big-icon-button:active {
        color: #ff0000;
      }
      #shutdown-button {
        margin-left: 80pt;
      }
      </style>
	</head>
	<body>
      <svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <defs>
        <symbol id="icon-settings" viewBox="0 0 32 32">
        <title>settings</title>
        <path d="M29.181 19.070c-1.679-2.908-0.669-6.634 2.255-8.328l-3.145-5.447c-0.898 0.527-1.943 0.829-3.058 0.829-3.361 0-6.085-2.742-6.085-6.125h-6.289c0.008 1.044-0.252 2.103-0.811 3.070-1.679 2.908-5.411 3.897-8.339 2.211l-3.144 5.447c0.905 0.515 1.689 1.268 2.246 2.234 1.676 2.903 0.672 6.623-2.241 8.319l3.145 5.447c0.895-0.522 1.935-0.82 3.044-0.82 3.35 0 6.067 2.725 6.084 6.092h6.289c-0.003-1.034 0.259-2.080 0.811-3.038 1.676-2.903 5.399-3.894 8.325-2.219l3.145-5.447c-0.899-0.515-1.678-1.266-2.232-2.226zM16 22.479c-3.578 0-6.479-2.901-6.479-6.479s2.901-6.479 6.479-6.479c3.578 0 6.479 2.901 6.479 6.479s-2.901 6.479-6.479 6.479z"></path>
        </symbol>
        <symbol id="icon-menu" viewBox="0 0 32 32">
        <title>menu</title>
        <path d="M2 6h28v6h-28zM2 14h28v6h-28zM2 22h28v6h-28z"></path>
        </symbol>
        <symbol id="icon-prev" viewBox="0 0 32 32">
        <title>prev</title>
        <path d="M8 28v-24h4v11l10-10v22l-10-10v11z"></path>
        </symbol>
        <symbol id="icon-next" viewBox="0 0 32 32">
        <title>next</title>
        <path d="M24 4v24h-4v-11l-10 10v-22l10 10v-11z"></path>
        </symbol>
        <symbol id="icon-poweroff" viewBox="0 0 32 32">
        <title>poweroff</title>
        <path d="M20 4.581v4.249c1.131 0.494 2.172 1.2 3.071 2.099 1.889 1.889 2.929 4.4 2.929 7.071s-1.040 5.182-2.929 7.071c-1.889 1.889-4.4 2.929-7.071 2.929s-5.182-1.040-7.071-2.929c-1.889-1.889-2.929-4.4-2.929-7.071s1.040-5.182 2.929-7.071c0.899-0.899 1.94-1.606 3.071-2.099v-4.249c-5.783 1.721-10 7.077-10 13.419 0 7.732 6.268 14 14 14s14-6.268 14-14c0-6.342-4.217-11.698-10-13.419zM14 0h4v16h-4z"></path>
        </symbol>
        <symbol id="icon-synctest" viewBox="0 0 32 32">
        <title>synctest</title>
        <path d="M16 8c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM16 21v-10c2.757 0 5 2.243 5 5s-2.243 5-5 5zM16 26c1.105 0 2 0.895 2 2v2c0 1.105-0.895 2-2 2s-2-0.895-2-2v-2c0-1.105 0.895-2 2-2zM16 6c-1.105 0-2-0.895-2-2v-2c0-1.105 0.895-2 2-2s2 0.895 2 2v2c0 1.105-0.895 2-2 2zM30 14c1.105 0 2 0.895 2 2s-0.895 2-2 2h-2c-1.105 0-2-0.895-2-2s0.895-2 2-2h2zM6 16c0 1.105-0.895 2-2 2h-2c-1.105 0-2-0.895-2-2s0.895-2 2-2h2c1.105 0 2 0.895 2 2zM25.899 23.071l1.414 1.414c0.781 0.781 0.781 2.047 0 2.828s-2.047 0.781-2.828 0l-1.414-1.414c-0.781-0.781-0.781-2.047 0-2.828s2.047-0.781 2.828 0zM6.101 8.929l-1.414-1.414c-0.781-0.781-0.781-2.047 0-2.828s2.047-0.781 2.828 0l1.414 1.414c0.781 0.781 0.781 2.047 0 2.828s-2.047 0.781-2.828 0zM25.899 8.929c-0.781 0.781-2.047 0.781-2.828 0s-0.781-2.047 0-2.828l1.414-1.414c0.781-0.781 2.047-0.781 2.828 0s0.781 2.047 0 2.828l-1.414 1.414zM6.101 23.071c0.781-0.781 2.047-0.781 2.828 0s0.781 2.047 0 2.828l-1.414 1.414c-0.781 0.781-2.047 0.781-2.828 0s-0.781-2.047 0-2.828l1.414-1.414z"></path>
        </symbol>
        </defs>
      </svg>
      <div id="status">Disconnected</div>
			<div id="controls">
				<a class="big-icon-button" onclick="sendPrev()"><svg><use xlink:href="#icon-prev"></use></svg></a>
        <a class="big-icon-button" onclick="sendTest()"><svg><use xlink:href="#icon-synctest"></use></svg></a>
        <a class="big-icon-button" onclick="sendNext()"><svg><use xlink:href="#icon-next"></use></svg></a>
			</div>
      <div id="sysinfo">No system info</div>
      <script>
        var socket;
        var minTimeout = 1000;
        var maxTimeout = 8000;
        var timeout = minTimeout;

        function connect() {
          document.getElementById("status").innerText = "Connecting...";
          console.log(new Date() + " Connecting...");
          socket = new WebSocket("ws://" + window.location.host + "/ws");
          socket.onopen = onopen;
          socket.onclose = onclose;
          socket.onerror = onerror;
          socket.onmessage = onmessage;
        }

        function onopen(event) {
          console.log(new Date() + " Connected to " + socket.url);
          document.getElementById("status").innerText = "Connected";
          timeout = minTimeout;
        }

        function onclose(event) {
          console.log(new Date() + " Disconnected");
          document.getElementById("status").innerText = "Disconnected";
          retry();
        }

        function onerror(event) {
          document.getElementById("status").innerText = "Connection Error";
          retry();
        }

        function onmessage(event) {
          let argv = event.data.split(" ");
          if (argv[0] == "play") {
            document.getElementById("status").innerText = 'Playing ' + argv[1] + '...';
          }
          else if (argv[0] == "sysinfo") {
            document.getElementById("sysinfo").innerText = argv[2] + " (" + argv[3] + "); " + argv[1];
          }
        }

        function retry() {
          if (socket) {
            console.log(new Date() + " Will retry in " + timeout + "ms");
            socket.close();
            socket = null;
            setTimeout(connect, timeout);
            timeout = Math.min(maxTimeout, timeout * 2);
          }
        }

        function sendNext() {
          if (socket) {
            socket.send("next");
          }
        }

        function sendPrev() {
          if (socket) {
            socket.send("prev");
          }
        }

        function sendTest() {
          if (socket) {
            socket.send("play synctest 0");
          }
        }

        function formatMS(ms) {
          var s = (ms/1000).toFixed(0);
          var m = (s/60).toFixed(0);
          return m + ':' + (s < 10 ? '0' : '') + s;
        }

        function ucFirst(s) {
          return s.charAt(0).toUpperCase() + s.slice(1);
        }

        connect();
		</script>
	</body>
</html>
